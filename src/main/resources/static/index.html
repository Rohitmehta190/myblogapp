<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Interactive Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 0; padding: 20px; background: #f7f7f9; color: #333; }
    h1 { margin-bottom: 20px; text-align: center; color: #1e40af; }
    h2, h3 { color: #1f2937; }
    .container { display: grid; grid-template-columns: 1fr 2fr; gap: 30px; }
    .card { background: #fff; border-radius: 12px; padding: 24px; box-shadow: 0 4px 20px rgba(0,0,0,.08); transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .card:hover { transform: translateY(-5px); box-shadow: 0 6px 25px rgba(0,0,0,.1); }
    input, textarea, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #ddd; font-size: 16px; transition: border-color 0.3s ease; }
    input:focus, textarea:focus { outline: none; border-color: #3b82f6; }
    button { cursor: pointer; border: none; background: #3b82f6; color: white; font-weight: 600; font-size: 16px; transition: background-color 0.3s ease; }
    button:hover { background: #2563eb; }
    .post { padding: 15px; border-bottom: 1px solid #eee; cursor: pointer; transition: background-color 0.3s ease, transform 0.2s ease; }
    .post:hover { background: #e0e7ff; transform: translateX(5px); }
    .muted { color: #6b7280; font-size: 14px; margin-top: 4px; }
    .row { display: flex; gap: 10px; }
    .row > * { flex: 1; }
    .actions { display: flex; gap: 10px; margin-top: 20px; }
    .danger { background: #ef4444; }
    .danger:hover { background: #dc2626; }
    .comment { padding: 12px 0; border-bottom: 1px dashed #e5e7eb; }
    
    /* Modal styles */
    .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); justify-content: center; align-items: center; }
    .modal-content { background-color: #fefefe; padding: 30px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); width: 90%; max-width: 500px; position: relative; }
    .close-button { color: #aaa; float: right; font-size: 28px; font-weight: bold; }
    .close-button:hover, .close-button:focus { color: black; text-decoration: none; cursor: pointer; }

    /* Animation and feedback */
    .loading-spinner { border: 4px solid rgba(0, 0, 0, 0.1); border-left-color: #3b82f6; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; display: inline-block; vertical-align: middle; margin-right: 8px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .post-content { line-height: 1.6; }
    .empty-state { text-align: center; color: #9ca3af; padding: 40px; }
    .error-input { border-color: #ef4444 !important; }

    /* Toast Notification */
    .toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 1000; }
    .toast { background-color: #333; color: white; padding: 15px 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); opacity: 0; transform: translateY(20px); transition: opacity 0.5s ease, transform 0.5s ease; }
    .toast.show { opacity: 1; transform: translateY(0); }
  </style>
</head>
<body>
  <h1>Interactive Blog</h1>
  <button onclick="openCreatePostModal()" style="margin-bottom: 20px; display: block; max-width: 200px; margin-left: auto; margin-right: auto;">‚úçÔ∏è Create New Post</button>
  
  <div class="container">
    <div>
      <div class="card">
        <h3>All Posts</h3>
        <div id="posts">
          <div class="loading-spinner"></div> Loading posts...
        </div>
      </div>
    </div>

    <div class="card">
      <div id="details">
        <p class="empty-state">Select a post to view its details here.</p>
      </div>
    </div>
  </div>

  <div id="createPostModal" class="modal">
    <div class="modal-content">
      <span class="close-button" onclick="closeCreatePostModal()">&times;</span>
      <h3>Create Post</h3>
      <input id="title" placeholder="Title" />
      <input id="author" placeholder="Author name" />
      <textarea id="content" rows="6" placeholder="Write something..."></textarea>
      <button onclick="createPost()">Publish</button>
    </div>
  </div>

  <div id="toast-container" class="toast-container"></div>

  <script>
    const api = {
      posts: '/api/posts'
    };

    async function fetchJSON(url, options = {}) {
      try {
        const res = await fetch(url, { headers: { 'Content-Type': 'application/json' }, ...options });
        if (!res.ok) throw new Error(await res.text());
        return res.json().catch(() => ({}));
      } catch (err) {
        showToast(`Error: ${err.message}`, 'danger');
        throw err;
      }
    }

    async function loadPosts() {
      const container = document.getElementById('posts');
      container.innerHTML = '<div class="loading-spinner"></div> Loading posts...';
      try {
        const posts = await fetchJSON(api.posts);
        container.innerHTML = '';
        if (posts.length === 0) {
          container.innerHTML = '<p class="empty-state">No posts yet. Be the first to publish one!</p>';
          return;
        }
        posts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        posts.forEach(p => {
          const div = document.createElement('div');
          div.className = 'post';
          div.innerHTML = `
            <strong>${escapeHtml(p.title)}</strong>
            <div class="muted">by ${escapeHtml(p.author || 'Anonymous')} ‚Ä¢ ${formatDate(p.createdAt)}</div>
          `;
          div.onclick = () => showPost(p.id);
          container.appendChild(div);
        });
      } catch (err) {
        container.innerHTML = '<p class="empty-state">Failed to load posts.</p>';
      }
    }

    function openCreatePostModal() {
      document.getElementById('createPostModal').style.display = 'flex';
      document.getElementById('title').focus();
    }

    function closeCreatePostModal() {
      document.getElementById('createPostModal').style.display = 'none';
      document.getElementById('title').value = '';
      document.getElementById('author').value = '';
      document.getElementById('content').value = '';
    }

    async function createPost() {
      const titleInput = document.getElementById('title');
      const contentInput = document.getElementById('content');
      const title = titleInput.value.trim();
      const author = document.getElementById('author').value.trim();
      const content = contentInput.value.trim();

      titleInput.classList.remove('error-input');
      contentInput.classList.remove('error-input');

      if (!title || !content) {
        showToast('Title and content are required.', 'danger');
        if (!title) titleInput.classList.add('error-input');
        if (!content) contentInput.classList.add('error-input');
        return;
      }

      await fetchJSON(api.posts, { method: 'POST', body: JSON.stringify({ title, author, content }) });
      showToast('Post published successfully! üéâ');
      closeCreatePostModal();
      await loadPosts();
    }

    async function showPost(id) {
      const details = document.getElementById('details');
      details.innerHTML = '<div class="loading-spinner"></div> Loading post...';
      try {
        const p = await fetchJSON(`${api.posts}/${id}`);
        const comments = await fetchJSON(`${api.posts}/${id}/comments`);
        details.innerHTML = `
          <h2>${escapeHtml(p.title)}</h2>
          <div class="muted">by ${escapeHtml(p.author || 'Anonymous')} ‚Ä¢ ${formatDate(p.createdAt)}</div>
          <p class="post-content">${escapeHtml(p.content).replace(/\n/g,'<br/>')}</p>

          <div class="actions">
            <button class="danger" onclick="deletePost(${p.id})">Delete Post</button>
          </div>

          <h3 style="margin-top: 20px;">Comments (${comments.length})</h3>
          <div id="comments">
            ${comments.length ? comments.map(c => `
              <div class="comment">
                <strong>${escapeHtml(c.name || 'Guest')}</strong>
                <div class="muted">${formatDate(c.createdAt)}</div>
                <div>${escapeHtml(c.content).replace(/\n/g,'<br/>')}</div>
              </div>
            `).join('') : '<p class="muted">No comments yet. Be the first!</p>'}
          </div>

          <h4>Add a comment</h4>
          <div class="row">
            <input id="cname" placeholder="Your name" />
          </div>
          <textarea id="ccontent" rows="3" placeholder="Your comment"></textarea>
          <button onclick="addComment(${p.id})">Comment</button>
        `;
      } catch (err) {
        details.innerHTML = `<p class="empty-state">Failed to load post details.</p>`;
      }
    }

    async function addComment(postId) {
      const name = document.getElementById('cname').value.trim();
      const contentInput = document.getElementById('ccontent');
      const content = contentInput.value.trim();
      contentInput.classList.remove('error-input');

      if (!content) {
        showToast('Comment content is required.', 'danger');
        contentInput.classList.add('error-input');
        return;
      }

      await fetchJSON(`${api.posts}/${postId}/comments`, { method: 'POST', body: JSON.stringify({ name, content }) });
      document.getElementById('cname').value = '';
      document.getElementById('ccontent').value = '';
      showToast('Comment added!');
      await showPost(postId);
    }

    async function deletePost(id) {
      if (!confirm('Are you sure you want to delete this post?')) return;
      const res = await fetch(`/api/posts/${id}`, { method: 'DELETE' });
      if (res.status === 204) {
        document.getElementById('details').innerHTML = '<p class="empty-state">Post deleted successfully.</p>';
        showToast('Post deleted! üóëÔ∏è');
        await loadPosts();
      } else {
        showToast('Failed to delete the post.', 'danger');
      }
    }

    function showToast(message, type = 'info') {
      const toastContainer = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      toastContainer.appendChild(toast);
      
      setTimeout(() => {
        toast.classList.add('show');
      }, 100);

      setTimeout(() => {
        toast.classList.remove('show');
        toast.addEventListener('transitionend', () => toast.remove());
      }, 3000);
    }

    // helpers
    function formatDate(d) {
      if (!d) return '';
      return new Date(d).toLocaleString();
    }
    function escapeHtml(str = '') {
      return str.replace(/[&<>"']/g, s => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[s]));
    }

    loadPosts().catch(err => console.error(err));
  </script>
</body>
</html>
